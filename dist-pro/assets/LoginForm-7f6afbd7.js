import{F as e}from"./Form-8ec9c562.js";import{d as s,b as a,m as o,u as t,az as r,q as i,r as l,a1 as n,J as d,o as p,h as m,w as c,e as u,t as g,a as h,B as f,g as j,K as w,k as v}from"./index-ab69a018.js";import{E as _}from"./el-button-5f0a8970.js";import{u as R}from"./useForm-2bc0283e.js";import{l as b,g as y,a as P}from"./index-b417ac4d.js";import{u as x}from"./useValidator-a63ee246.js";import{_ as I}from"./_plugin-vue_export-helper-1b428a4d.js";import"./el-col-de71804c.js";import"./el-popper-2ba03ef0.js";import"./constants-136ce4ac.js";import"./el-input-5d13ef5f.js";import"./event-5568c9d8.js";import"./use-form-item-da890dc1.js";import"./use-form-common-props-5bbac68f.js";import"./el-tag-2eba6023.js";import"./tsxHelper-56b0b5a4.js";import"./scroll-dfd4dc88.js";import"./debounce-9059d122.js";import"./validator-1449e5a2.js";import"./el-input-number-58ddfaed.js";import"./el-switch-c5d5e959.js";import"./el-divider-67b7467a.js";import"./InputPassword-684f4247.js";import"./style.css_vue_type_style_index_0_src_true_lang-c579c63b.js";import"./aria-ecee1d93.js";const k={class:"text-2xl font-bold text-center w-[100%]"},F={class:"w-[100%]"},q={class:"w-[100%] mt-15px"},A=I(s({__name:"LoginForm",emits:["to-register"],setup(s,{emit:I}){const{required:A}=x(),C=a(),D=o(),{currentRoute:E,addRoute:z,push:U}=t(),{wsCache:V}=r(),{t:B}=v(),H={username:[A()],password:[A()]},J=i([{field:"title",colProps:{span:24}},{field:"username",label:B("login.username"),value:"admin",component:"Input",colProps:{span:24},componentProps:{placeholder:B("login.usernamePlaceholder")}},{field:"password",label:B("login.password"),value:"admin",component:"InputPassword",colProps:{span:24},componentProps:{style:{width:"100%"},placeholder:B("login.passwordPlaceholder")}},{field:"tool",colProps:{span:24}},{field:"login",colProps:{span:24}},{field:"otherIcon",colProps:{span:24}}]),{register:K,elFormRef:L,methods:N}=(l(!1),R()),S=l(!1),T=l("");n((()=>E.value),(e=>{var s;T.value=null==(s=null==e?void 0:e.query)?void 0:s.redirect}),{immediate:!0});const W=async()=>{const e=h(L);await(null==e?void 0:e.validate((async e=>{if(e){S.value=!0;const{getFormData:e}=N,s=await e();try{const e=await b(s);e&&(V.set(C.getUserInfo,e.data),C.getDynamicRouter?X():(await D.generateRoutes("none").catch((()=>{})),D.getAddRouters.forEach((e=>{z(e)})),D.setIsAddRouters(!0),U({path:T.value||D.addRouters[0].path})))}finally{S.value=!1}}})))},X=async()=>{const{getFormData:e}=N,s=await e(),a={roleName:s.username},o="admin"===s.username?await y(a):await P(a);if(o){const{wsCache:e}=r(),a=o.data||[];e.set("roleRouters",a),"admin"===s.username?await D.generateRoutes("admin",a).catch((()=>{})):await D.generateRoutes("test",a).catch((()=>{})),D.getAddRouters.forEach((e=>{z(e)})),D.setIsAddRouters(!0),U({path:T.value||D.addRouters[0].path})}},Y=()=>{I("to-register")};return(s,a)=>{d("Icon");return p(),m(h(e),{schema:J,rules:H,"label-position":"top","hide-required-asterisk":"",size:"large",class:"dark:border-1 dark:border-[var(--el-border-color)] dark:border-solid",onRegister:h(K)},{title:c((()=>[u("h2",k,g(h(B)("login.login")),1)])),tool:c((()=>[f("",!0)])),login:c((()=>[u("div",F,[j(h(_),{loading:S.value,type:"primary",class:"w-[100%]",onClick:W},{default:c((()=>[w(g(h(B)("login.login")),1)])),_:1},8,["loading"])]),u("div",q,[j(h(_),{class:"w-[100%]",onClick:Y},{default:c((()=>[w(g(h(B)("login.register")),1)])),_:1})])])),otherIcon:c((()=>[f("",!0)])),_:1},8,["schema","onRegister"])}}}),[["__scopeId","data-v-d7ca3728"]]);export{A as default};
